schema-version: 1.0

type: builder


const:
  srcDir: /usr/src
  exportDir: /opt/gcc

dependencies:
  - gmp
  - mpfr
  - mpc
  - bison
  - flex
  - texinfo

#  - zlib

provision:
  - url:
      from: https://ftp.gnu.org/gnu/gcc/gcc-{% version %}/gcc-{% version %}.tar.xz
      todir: "{% srcDir %}"
  - folder: "{% srcDir %}/gcc-{% version %}/build"
  - copy:
      resource: gcc.conf
      todir: "{% exportDir %}/etc/ld.so.conf.d"

build:
  - shell:
      cmd: sed -e '/static.*SIGSTKSZ/d' -e 's/return kAltStackSize/return SIGSTKSZ * 4/' -i libsanitizer/sanitizer_common/sanitizer_posix_libcdep.cpp
      directory: "{% srcDir %}/gcc-{% version %}"
  - shell:
      cmds:
       - ../configure LD=ld --enable-languages=c,c++,go --disable-multilib
       - make -j12
       - make install DESTDIR={% exportDir %}
      directory: "{% srcDir %}/gcc-{% version %}/build"
  - export: "{% exportDir %}"

